# AqiveLife 應用 (WebView Hybrid App) 0514

## 專案概述

AqiveLife 是一款搭配 Aqive 系列氣機產品（如撓定、撓氣源寶）設計的數位輔助工具。通過簡單儀式引導、每日狀態追蹤與資料視覺化，協助用戶有效提升身心狀態。本應用採用 Web App + Capacitor 混合 App 架構開發，以加速上架並提升跨平台效率。

### 主要目標

- 強化實體氣機產品的使用體驗與儀式感
- 協助用戶追蹤情緒與專注、睡眠狀態變化
- 為品牌蒐集匿名化使用數據與場景洞察

### 目標用戶

- 使用 Aqive 氣機產品的消費者
- 關注身心靈健康、具冥想／能量調頻習慣的用戶
- 偏好輕量、可視化、自我追蹤工具的行動裝置使用者

## 技術架構

- **前端框架**：Next.js (支援 SSR 與 SEO)
- **UI 框架**：Tailwind CSS + Headless UI
- **App 打包**：Capacitor.js (iOS / Android)
- **資料儲存**：Firebase Firestore (NoSQL)
- **認證與推播**：Firebase Auth + FCM
- **數據分析**：GA4 + Amplitude

## 功能模組

### 用戶端功能

#### 1. 登入與初始設定
- 使用 Firebase Auth 實作 Gmail 登入和 Apple 登入功能（已移除匿名登入選項）
- 用戶頭像支援：Google 頭像顯示或 Apple 用戶自動生成頭像
- 當用戶沒有設置頭像時，使用 aqive-symbol.svg 作為預設圖像
- 為用戶提供簡易帳號綁定流程
- 初次登入時引導選擇目標（放鬆、專注、睡眠）

#### 2. 儀式模式與回饋
- 主畫面提供「開始調頻」按鈕
- 播放內建聲音（HTML5 Audio）與靜態圖像／動畫引導
- 調頻結束後顯示完成頁面：
  - 記錄「氣定神閒控制度」
  - 提供記錄能力變化的文本框
  - 允許保存記錄或暫時略過
- 儀式結束後詢問「你感覺如何？」快速情緒選單

#### 3. 狀態追蹤
- 每日可記錄焦慮、專注、睡眠指數（0-10 滑動）
- 可額外補充簡短日記紀錄（300 字內）

#### 4. 數據視覺化
- 顯示本週使用次數圖表
- 顯示焦慮/睡眠/專注變化折線圖（Chart.js）

#### 5. 推播提醒
- 提供每日一次推播提醒
- 使用 Capacitor Push Plugin + Firebase Cloud Messaging
- 推播設定統一在設定頁面管理，優化用戶體驗

### 管理後台（僅限內部）

#### 1. 儀式使用統計
- 顯示全體用戶每日使用次數、平均使用時間

#### 2. 情緒趨勢報表
- 匯總用戶每日記錄情緒平均值
- 圖表顯示與 CSV 匯出功能

#### 3. 用戶清單
- 顯示用戶 ID、登入方式（Google/Apple）、首次登入日、累積使用天數
- 可查看用戶基本資料（不含私人聯絡資訊）
- 僅作為資料觀察，無直接聯絡機制

## 專案設置

### 開發環境需求

- Node.js 18+
- npm 或 yarn
- Firebase CLI
- iOS/Android 開發環境（用於測試原生功能）

### 安裝步驟

```bash
# 複製專案
git clone [repo-url] AqiveLife
cd AqiveLife

# 安裝依賴
npm install

# 設置環境變數
cp .env.example .env.local
# 編輯 .env.local 填入 Firebase 配置信息

# 啟動開發服務器
npm run dev
```

### App 構建

```bash
# 構建 Web 版本
npm run build

# 添加平台
npx cap add ios
npx cap add android

# 更新原生專案
npx cap sync

# 打開原生 IDE
npx cap open ios
npx cap open android
```

## 資料庫結構

### Firestore 集合

- **users**: 用戶資料與偏好設定
  - userId: Firebase Auth UID (唯一識別符，來自 Google/Apple 登入)
  - displayName: 用戶顯示名稱 (來自 Google/Apple，可選)
  - email: 用戶電子郵件 (來自 Google/Apple，主要用於帳號識別，不直接用於行銷聯絡)
  - photoURL: 用戶頭像 URL (來自 Google/Apple，可選)
  - createdAt: 建立時間
  - goal: 用戶選擇的目標 (放鬆/專注/睡眠)
  - deviceToken: 用於推播的設備標識
  - settings: 用戶設定 (通知偏好等)

- **sessions**: 調頻儀式使用記錄
  - sessionId: 唯一識別符
  - userId: 關聯用戶
  - startTime: 開始時間
  - endTime: 結束時間
  - duration: 持續時間 (分鐘)
  - programType: 使用的調頻類型
  - emotionAfter: 儀式後情緒評分

- **dailyLogs**: 每日情緒與專注記錄
  - logId: 唯一識別符
  - userId: 關聯用戶
  - date: 記錄日期
  - anxietyLevel: 焦慮指數 (0-10)
  - focusLevel: 專注指數 (0-10)
  - sleepQuality: 睡眠品質 (0-10)
  - notes: 用戶筆記
  
- **reminders**: 推播設定
  - reminderId: 唯一識別符
  - userId: 關聯用戶
  - time: 提醒時間
  - active: 是否啟用
  - message: 提醒內容

## 開發規範

### 代碼風格

- 使用 TypeScript 進行靜態類型檢查
- 遵循 ESLint 與 Prettier 配置
- 使用 React Hooks 與函數式元件

### 目錄結構

```
/app                  # Next.js 頁面與路由
/components           # React 元件
/lib                  # 通用函數與工具
/hooks                # 自定義 React Hooks
/styles               # 全局樣式
/public               # 靜態資源
/capacitor            # 原生平台配置
/firebase             # Firebase 相關配置與函數
```

### 分支管理

- `main`: 生產環境分支
- `dev`: 開發主分支
- `feature/*`: 功能開發分支
- `bugfix/*`: 錯誤修復分支

## 待辦事項

### MVP 階段優先實現

- [ ] Gmail 與 Apple ID 用戶認證與初始設定流程 (UI 設計完成，後端整合中)
- [ ] 儀式引導核心功能
- [ ] 基礎數據收集與視覺化
- [ ] 中文版穩定上線後，規劃開發英文版以拓展國際用戶

### 未來功能規劃

- [ ] 社群功能與經驗分享
- [ ] 智能推薦系統
- [ ] 與智能穿戴設備整合
- [ ] 付費訂閱高級功能

## 資料安全與隱私

- 用戶資料加密存儲
- 用戶數據將進行去識別化處理後，用於聚合分析與產品優化
- 符合 GDPR 要求的隱私政策
- 定期資料備份與恢復機制

## 尚需考慮的方面及處理方式

### 1. 資料安全與隱私保護

#### 處理方式：
- **資料加密實施**：
  - 使用 Firebase 的客戶端加密庫對敏感資料進行端到端加密
  - 實作 AES-256 加密演算法保護本地存儲的資料
  - 為傳輸中的資料強制使用 HTTPS/TLS 1.3

- **隱私政策與用戶協議**：
  - 聘請法律專家起草符合 GDPR、CCPA 等法規的隱私政策
  - 在應用首次啟動時提供清晰的隱私同意選項
  - 實作隱私儀表板讓用戶可查看和刪除自己的資料

- **資料備份策略**：
  - 配置 Firebase 每日自動備份
  - 實作資料導出功能，允許用戶下載個人數據
  - 建立資料復原流程和定期測試恢復機制

### 2. 離線功能支援

#### 處理方式：
- **離線資料緩存**：
  - 使用 Firebase Firestore 離線持久化功能
  - 實作 Service Worker 配合 IndexedDB 存儲關鍵資料
  - 採用 Workbox 管理離線資源緩存

- **同步衝突處理**：
  - 實作基於時間戳的衝突解決策略
  - 設計用戶友好的同步衝突提示界面
  - 建立重要操作的離線隊列系統

- **離線功能界限**：
  - 明確標示哪些功能在離線模式下可用
  - 為離線模式提供替代流程（如儀式記錄暫存）
  - 網絡恢復時提供友好通知

### 3. 使用者體驗優化

#### 處理方式：
- **首次使用引導**：
  - 設計 3-5 步的簡潔引導流程
  - 使用 React-Joyride 實現互動式引導
  - 加入可跳過選項和進度指示

- **無障礙設計**：
  - 遵循 WCAG 2.1 AA 標準
  - 使用 React-axe 測試元件無障礙性
  - 支援螢幕閱讀器和鍵盤操作
  - 確保色彩對比度符合標準

- **多設備適配**：
  - 使用 CSS Grid 和 Flexbox 實現響應式設計
  - 針對平板和桌面版建立專用佈局
  - 實作適配不同螢幕比例的媒體查詢
  - 為各種設備尺寸優化動畫和交互

### 4. 擴展性考慮

#### 處理方式：
- **多語言支援**：
  - 使用 next-i18next 建立國際化框架
  - 使用 JSON 格式存儲翻譯文本
  - 實作語言偵測和切換機制
  - 支援東亞語言的字體載入優化

- **API 版本控制**：
  - 在 API 路徑中包含版本號（如 `/api/v1/`）
  - 使用 API Gateway 管理不同版本的路由
  - 建立 API 變更日誌和棄用政策
  - 實作向後兼容性測試

- **第三方整合**：
  - 建立模塊化的整合適配器層
  - 為健康應用（Apple Health/Google Fit）建立連接器
  - 使用 OAuth 2.0 實現第三方授權
  - 設計健康資料導入/導出格式

### 5. 測試與品質保證

#### 處理方式：
- **測試策略**：
  - 使用 Jest 進行單元測試（目標覆蓋率 >80%）
  - 使用 React Testing Library 進行元件測試
  - 使用 Cypress 進行端到端測試
  - 設置持續整合流程自動運行測試

- **效能測試**：
  - 使用 Lighthouse 和 Web Vitals 監控關鍵指標
  - 建立效能預算（如首次載入 < 2秒）
  - 實作代碼分割和延遲載入策略
  - 優化資源載入順序和關鍵渲染路徑

- **錯誤監控**：
  - 整合 Sentry 進行前端錯誤捕獲
  - 設置 Firebase Crashlytics 收集移動端崩潰報告
  - 建立自動化錯誤分類和優先級系統
  - 實作用戶反饋流程收集體驗問題

### 6. 版本迭代規劃

#### 處理方式：
- **更新機制**：
  - 在應用啟動時檢查更新
  - 實作 PWA 的自動更新功能
  - 設計強制更新和選擇性更新策略
  - 為重大更新提供功能介紹頁面

- **發布流程**：
  - 建立 Beta 測試用戶群
  - 使用 CodePush/App Center 進行熱更新
  - 建立逐步推出策略以監控穩定性
  - 設計 A/B 測試框架評估新功能
  - 制定每月發布規劃和季度主要更新計劃

- **功能優先級框架**：
  - 使用 RICE(Reach, Impact, Confidence, Effort)模型評估功能優先級
  - 建立用戶反饋收集與投票系統
  - 實施週期性功能評審與調整流程


## 開發計劃時間線

### 第一階段：基礎架構與核心功能 (1-2 個月)
- 設置開發環境與 CI/CD 管道
- 實現 Gmail 與 Apple ID 用戶認證與初始設定流程 (UI 設計完成，後端整合中)
- 開發儀式引導核心功能
- 構建基本資料收集與存儲系統

### 第二階段：數據視覺化與互動優化 (1 個月)
- 實現各種數據視覺化圖表
- 優化使用者介面與互動體驗
- 完善離線使用模式
- 添加推播通知功能

### 第三階段：管理後台與測試 (1 個月)
- 開發內部管理後台
- 進行全面測試與問題修復
- 實施安全審計與隱私評估
- 準備上架應用商店

### 第四階段：發布與監控 (持續進行)
- 應用正式發布
- 監控使用情況與效能
- 收集用戶反饋
- 規劃未來迭代功能

---

© 2025 AqiveLife. 版權所有。 